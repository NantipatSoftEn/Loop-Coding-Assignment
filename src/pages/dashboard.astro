---
import HeaderLink from '@/components/HeaderLink.astro'
import Layout from '@/layouts/templateRestaurants.astro'
import type { DataBooking } from '@/lib/db'
import { fetchBookings } from '@/pages/api/getbooking'

const user = Astro.locals.user
if (!user) {
  return Astro.redirect('/signin')
}
const bookings: DataBooking[] = await fetchBookings(user.username)
---

<Layout>
  <div class="container">
    <h1 class="mb-4">Booking Dashboard</h1>
    <HeaderLink href="/list">กลับหน้าหลัก</HeaderLink>
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">restaurant</th>
          <th scope="col">Date</th>
          <th scope="col">Time</th>
          <th scope="col">Guests</th>
          <th scope="col">QRCODE</th>
        </tr>
      </thead>
      <tbody>
        {
          bookings.map((booking: DataBooking) => (
            <tr>
              <th scope="row">{booking.id}</th>
              <td>{booking.username}</td>
              <td>{booking.restaurant}</td>
              <td>{booking.date}</td>
              <td>{booking.time}</td>
              <td>{booking.guests}</td>
              <td>
                <img
                  src="https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg"
                  width="128"
                />
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</Layout>
